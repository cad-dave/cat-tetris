<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Meow-tris üê± Speed Run Challenge</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Leaderboard Modal -->
    <div id="leaderboardModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üèÜ Speed Run Records</h2>
                <button class="modal-close" id="closeLeaderboard">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-subtitle">Race to 4500 points - Fastest times win!</p>
                <div id="leaderboardList" class="leaderboard-list">
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary" id="clearLeaderboard">Clear Records</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Name Input Modal (shown when player wins) -->
    <div id="nameModal" class="modal">
        <div class="modal-content name-modal">
            <div class="modal-header">
                <h2>üéâ You Win!</h2>
            </div>
            <div class="modal-body">
                <p class="modal-subtitle">You reached 4500 points!</p>
                <div class="time-display-large" id="finalTimeDisplay">0:00.0</div>
                <div class="name-input-container">
                    <label class="name-label" for="playerName">Enter your name for the leaderboard:</label>
                    <input 
                        type="text" 
                        id="playerName" 
                        class="name-input" 
                        placeholder="Your name..." 
                        maxlength="32"
                        autocomplete="off"
                    >
                    <p class="name-hint">Leave blank to save as "Anonymous Cat"</p>
                </div>
                <button class="btn-primary" id="saveName">üêæ Save Score</button>
            </div>
        </div>
    </div>

    <!-- Mobile header bar (hidden on desktop) -->
    <div id="mobile-header">
        <div class="mh-score">
            <div class="mh-score-num" id="scoreMobile">0</div>
            <div class="mh-progress-bar">
                <div class="mh-progress-fill" id="progressBarMobile"></div>
            </div>
        </div>
        <div class="mh-timer">
            <div class="mh-timer-val" id="timerMobile">0:00.0</div>
            <div class="mh-best">
                <span id="bestTimeMobile">--:--.-</span>
                <span class="mh-crown" id="recordHolderMobile"></span>
            </div>
        </div>
        <div class="mh-actions">
            <button class="mh-records-btn" id="viewLeaderboardMobile" aria-label="View Records">üèÜ</button>
        </div>
    </div>

    <div class="game-wrapper">
        <button id="startBtn" type="button" class="startBtn">
            Pet Me to Start
        </button>

        <main class="container">
            <!-- Left sidebar: Next piece + PAWS only on mobile -->
            <aside class="sidebar left">
                <div class="scorebox">
                    <h3>Next</h3>
                    <canvas id="next" width="120" height="120" aria-label="Next Tetris Piece"></canvas>
                </div>
                <div class="scorebox sidebar-paws">
                    <button id="btn-paws" class="btn-paws-sidebar">üêæ<br>PAWS</button>
                </div>
                <!-- Desktop only extras -->
                <div class="scorebox desktop-only">
                    <h3>‚è±Ô∏è Time</h3>
                    <div class="timer-display" id="timer">0:00.0</div>
                    <div class="record-display">
                        <span class="record-label">Best:</span>
                        <span id="bestTime">--:--.-</span>
                    </div>
                    <div class="record-holder" id="recordHolder" style="display:none">
                        <span>üëë</span>
                        <span id="recordHolderName">--</span>
                    </div>
                </div>
            </aside>

            <div class="game-area">
                <div class="canvas-wrapper">
                    <canvas id="tetris" width="200" height="400" aria-label="Tetris Game Board" role="application"></canvas>
                    <canvas id="effects" width="200" height="400" aria-label="Visual Effects Layer"></canvas>
                </div>
            </div>

            <aside class="sidebar right">
                <div class="scorebox" id="stats">
                    <h3>üéØ Progress</h3>
                    <div class="score-large" id="score">0</div>
                    <div class="score-target">/ 4500</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar"></div>
                    </div>
                    <div class="stat-row"><strong>Level:</strong> <span id="level">1</span></div>
                    <div class="stat-row"><strong>Lines:</strong> <span id="lines">0</span></div>
                </div>
                <div class="scorebox">
                    <button class="btn-leaderboard" id="viewLeaderboard">
                        üèÜ View Records
                    </button>
                </div>
                <div class="scorebox controls-info">
                    <h3>Controls</h3>
                    <div>Move: ‚Üê / ‚Üí</div>
                    <div>Drop: ‚Üì</div>
                    <div>Rotate: Q / W</div>
                    <div>Pause: SPACE</div>
                </div>
            </aside>
        </main>
    </div>

    <div id="mobile-controls">
        <button id="btn-left" class="move-btn">‚óÄ</button>
        <div class="center-controls">
            <button id="btn-rotate" class="action-btn">‚ü≥</button>
            <button id="btn-down" class="move-btn">‚ñº</button>
        </div>
        <button id="btn-right" class="move-btn">‚ñ∂</button>
    </div>

    <!-- Audio elements -->
    <audio id="gameMusic" loop preload="auto">
        <source src="Music.mp3" type="audio/mpeg">
    </audio>

    <audio id="clearSound" preload="auto">
        <source src="clear.mp3" type="audio/mpeg">
    </audio>

    <audio id="roarSound" preload="auto">
        <source src="roar.mp3" type="audio/mpeg">
    </audio>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         üî• FIREBASE SETUP
         Replace the YOUR_* values below with your Firebase project config.
         Find them at: Firebase Console ‚Üí Project Settings ‚Üí Your apps ‚Üí Web
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import {
            getFirestore,
            collection,
            addDoc,
            query,
            orderBy,
            limit,
            getDocs
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey:            "AIzaSyDn65M2YeDjSw3sSRKQfCsTLwY_pjMUFLI",
            authDomain:        "feb17tetris.firebaseapp.com",
            projectId:         "feb17tetris",
            storageBucket:     "feb17tetris.firebasestorage.app",
            messagingSenderId: "426189788647",
            appId:             "1:426189788647:web:ba67a994aef918f77f5942"
        };

        const app = initializeApp(firebaseConfig);
        const db  = getFirestore(app);

        // Expose everything tetris.js needs via a single global object
        window.firebaseLeaderboard = {
            db,
            collection: collection(db, "leaderboard"),
            addDoc,
            getDocs,
            query,
            orderBy,
            limit
        };
    </script>

    <!-- Your main game script -->
    <script type="module" src="tetris.js"></script>
</body>
</html>
